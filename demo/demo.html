<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demo ImobFlash - 3 Vis√µes</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body { 
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; 
    background-color: #1a1a1a; 
    padding: 20px;
    overflow-x: auto;
  }
  
  .container {
    display: flex;
    gap: 30px;
    justify-content: center;
    align-items: flex-start;
    min-width: fit-content;
    padding: 20px;
  }
  
  .view-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    transition: all 0.3s ease;
  }
  
  .view-section.active {
    transform: scale(1.05);
  }
  
  .view-section.active .phone {
    box-shadow: 0 0 30px rgba(76, 175, 80, 0.8), 0 0 60px rgba(76, 175, 80, 0.5);
    border: 3px solid #4caf50 !important;
  }
  
  .view-section.active .agent-phone {
    box-shadow: 0 0 30px rgba(76, 175, 80, 0.8), 0 0 60px rgba(76, 175, 80, 0.5);
    border: 3px solid #4caf50 !important;
    outline: 3px solid #4caf50;
  }
  
  .view-title {
    color: white;
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 10px;
    text-align: center;
  }
  
  /* Control Panel */
  .control-panel {
    position: fixed;
    bottom: 30px;
    right: 30px;
    display: flex;
    align-items: center;
    gap: 15px;
    z-index: 10001;
  }
  
  .play-button {
    background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
    color: white;
    border: none;
    padding: 15px 25px;
    border-radius: 50px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
    transition: transform 0.2s, box-shadow 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .play-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
  }
  
  .play-button.paused {
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
  }
  
  .play-button.paused:hover {
    box-shadow: 0 6px 20px rgba(255, 152, 0, 0.5);
  }
  
  .play-button.restart {
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
  }
  
  .play-button.restart:hover {
    box-shadow: 0 6px 20px rgba(255, 107, 53, 0.5);
  }
  
  .speed-control {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(255, 255, 255, 0.95);
    padding: 10px 15px;
    border-radius: 50px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }
  
  .speed-label {
    font-size: 14px;
    font-weight: 600;
    color: #333;
    white-space: nowrap;
  }
  
  .speed-input {
    width: 80px;
    padding: 8px 12px;
    border: 2px solid #ddd;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    outline: none;
    transition: border-color 0.2s;
  }
  
  .speed-input:focus {
    border-color: #667eea;
  }
  
  .speed-input::-webkit-inner-spin-button,
  .speed-input::-webkit-outer-spin-button {
    opacity: 1;
  }
  
  /* Restart Button */
  .restart-button {
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    color: white;
    border: none;
    padding: 15px 25px;
    border-radius: 50px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
    transition: transform 0.2s, box-shadow 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .restart-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 107, 53, 0.5);
  }
  
  /* Phone Mockup */
  .phone { 
    width: 350px; 
    height: 700px; 
    background-color: #fff; 
    border-radius: 30px; 
    box-shadow: 0 20px 50px rgba(0,0,0,0.3); 
    overflow: hidden; 
    position: relative; 
    border: 8px solid #333; 
  }
  
  /* Desktop Mockup */
  .desktop {
    width: 600px;
    height: 700px;
    background-color: #2d2d2d;
    border-radius: 10px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    overflow: hidden;
    position: relative;
    border: 3px solid #444;
  }
  
  .desktop-screen {
    width: 100%;
    height: 100%;
    background: #f5f5f5;
    overflow: hidden;
    position: relative;
  }
  
  /* WhatsApp Chat Styles */
  .header { 
    background-color: #075e54; 
    color: white; 
    padding: 15px; 
    display: flex; 
    align-items: center; 
    z-index: 10; 
    position: relative; 
  }
  
  .avatar { 
    width: 40px; 
    height: 40px; 
    background-color: #ddd; 
    border-radius: 50%; 
    margin-right: 10px; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-size: 20px; 
  }
  
  .info h3 { 
    margin: 0; 
    font-size: 16px; 
    font-weight: 500; 
  }
  
  .info p { 
    margin: 0; 
    font-size: 12px; 
    opacity: 0.8; 
  }
  
  .chat-area { 
    height: 580px; 
    background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); 
    background-color: #e5ddd5; 
    overflow-y: auto; 
    padding: 15px; 
    padding-bottom: 60px; 
    display: flex; 
    flex-direction: column; 
  }
  
  .message { 
    max-width: 80%; 
    padding: 8px 12px; 
    margin-bottom: 10px; 
    border-radius: 8px; 
    font-size: 14px; 
    line-height: 1.4; 
    position: relative; 
    opacity: 0; 
    animation: fadeIn 0.3s forwards; 
    box-shadow: 0 1px 1px rgba(0,0,0,0.1); 
  }
  
  .message.received { 
    background-color: #fff; 
    align-self: flex-start; 
    border-top-left-radius: 0; 
  }
  
  .message.sent { 
    background-color: #dcf8c6; 
    align-self: flex-end; 
    border-top-right-radius: 0; 
  }
  
  .meta { 
    font-size: 10px; 
    color: #999; 
    text-align: right; 
    margin-top: 4px; 
  }
  
  .typing { 
    font-size: 12px; 
    color: #075e54; 
    margin-left: 15px; 
    margin-bottom: 10px; 
    font-style: italic; 
    display: none; 
  }

  @keyframes fadeIn { 
    to { opacity: 1; } 
  }
  
  .input-area { 
    position: absolute; 
    bottom: 0; 
    width: 100%; 
    height: 60px; 
    background: #f0f0f0; 
    display: flex; 
    align-items: center; 
    padding: 0 10px; 
    box-sizing: border-box; 
    z-index: 10;
  }
  
  .input-fake { 
    flex: 1; 
    height: 35px; 
    background: white; 
    border-radius: 20px; 
    margin: 0 10px; 
    padding: 10px; 
    color: #999; 
    font-size: 14px; 
    display: flex; 
    align-items: center; 
  }
  
  /* Portal Styles */
  .click-indicator {
    position: absolute;
    width: 50px;
    height: 50px;
    border: 4px solid #ff1744;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 23, 68, 0.4) 0%, rgba(255, 23, 68, 0.1) 70%, transparent 100%);
    pointer-events: none;
    z-index: 10000;
    display: none;
    transform: translate(-50%, -50%);
    animation: clickPulse 0.6s ease-out;
    box-shadow: 0 0 20px rgba(255, 23, 68, 0.8), 0 0 40px rgba(255, 23, 68, 0.4);
  }
  
  .click-indicator::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    background: #ff1744;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    animation: clickInner 0.6s ease-out;
  }
  
  @keyframes clickPulse {
    0% {
      transform: translate(-50%, -50%) scale(0.5);
      opacity: 1;
      box-shadow: 0 0 10px rgba(255, 23, 68, 0.8), 0 0 20px rgba(255, 23, 68, 0.4);
    }
    50% {
      transform: translate(-50%, -50%) scale(1.2);
      opacity: 0.8;
      box-shadow: 0 0 30px rgba(255, 23, 68, 1), 0 0 60px rgba(255, 23, 68, 0.6);
    }
    100% {
      transform: translate(-50%, -50%) scale(2);
      opacity: 0;
      box-shadow: 0 0 50px rgba(255, 23, 68, 0.8), 0 0 100px rgba(255, 23, 68, 0.4);
    }
  }
  
  @keyframes clickInner {
    0% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    100% {
      transform: translate(-50%, -50%) scale(0.3);
      opacity: 0;
    }
  }
  
  .portal-header {
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    color: white;
    padding: 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    z-index: 10;
    position: relative;
  }
  
  .portal-logo {
    font-size: 20px;
    font-weight: bold;
  }
  
  .search-icon {
    font-size: 20px;
    cursor: pointer;
  }
  
  .search-bar {
    background: rgba(255,255,255,0.2);
    border-radius: 20px;
    padding: 8px 15px;
    margin: 10px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    color: white;
    font-size: 14px;
  }
  
  .loading-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 100;
    transition: opacity 0.5s;
  }
  
  .loading-screen.hidden {
    opacity: 0;
    pointer-events: none;
  }
  
  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #ff6b35;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .property-list {
    height: 620px;
    overflow-y: auto;
    background: #f8f8f8;
    padding-bottom: 60px;
  }
  
  .property-card {
    background: white;
    margin: 10px;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    opacity: 0;
    animation: fadeInUp 0.5s forwards;
  }
  
  .property-card:nth-child(1) { animation-delay: 0.1s; }
  .property-card:nth-child(2) { animation-delay: 0.2s; }
  .property-card:nth-child(3) { animation-delay: 0.3s; }
  .property-card:nth-child(4) { animation-delay: 0.4s; }
  
  .property-card:active {
    transform: scale(0.98);
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .card-image {
    width: 100%;
    height: 180px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  
  .card-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.6);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
    z-index: 2;
  }
  
  .card-content {
    padding: 15px;
  }
  
  .card-price {
    font-size: 22px;
    font-weight: bold;
    color: #ff6b35;
    margin-bottom: 5px;
  }
  
  .card-title {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    margin-bottom: 8px;
  }
  
  .card-location {
    font-size: 13px;
    color: #666;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  
  .card-features {
    display: flex;
    gap: 15px;
    margin-top: 10px;
    font-size: 12px;
    color: #999;
  }
  
  .property-detail {
    height: 620px;
    overflow-y: auto;
    background: white;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
    z-index: 5;
  }
  
  .property-detail.show {
    transform: translateX(0);
  }
  
  .image-gallery {
    width: 100%;
    height: 250px;
    position: relative;
    overflow: hidden;
  }
  
  .gallery-container {
    display: flex;
    width: 400%;
    height: 100%;
    transition: transform 0.5s ease-in-out;
  }
  
  .gallery-image {
    width: 25%;
    height: 100%;
    flex-shrink: 0;
    background-size: cover;
    background-position: center;
  }
  
  .gallery-image.sala {
    background-image: url('images/sala.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  
  .gallery-image.cozinha {
    background-image: url('images/cozinha.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  
  .gallery-image.fachada {
    background-image: url('images/fachada.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  
  .gallery-image.banheiro {
    background-image: url('images/banheiro.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  
  .gallery-dots {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 3;
  }
  
  .gallery-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255,255,255,0.5);
    cursor: pointer;
    transition: background 0.3s;
  }
  
  .gallery-dot.active {
    background: white;
    width: 24px;
    border-radius: 4px;
  }
  
  .back-button {
    position: absolute;
    top: 15px;
    left: 15px;
    background: rgba(0,0,0,0.5);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 4;
  }
  
  .property-details {
    padding: 20px;
  }
  
  .property-price {
    font-size: 28px;
    font-weight: bold;
    color: #ff6b35;
    margin-bottom: 10px;
    opacity: 0;
    animation: fadeIn 0.5s 0.2s forwards;
  }
  
  .property-title {
    font-size: 20px;
    font-weight: 600;
    color: #333;
    margin-bottom: 15px;
    opacity: 0;
    animation: fadeIn 0.5s 0.3s forwards;
  }
  
  .property-location {
    display: flex;
    align-items: center;
    color: #666;
    font-size: 14px;
    margin-bottom: 20px;
    opacity: 0;
    animation: fadeIn 0.5s 0.4s forwards;
  }
  
  .property-location::before {
    content: 'üìç';
    margin-right: 5px;
  }
  
  .property-features {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
    opacity: 0;
    animation: fadeIn 0.5s 0.5s forwards;
  }
  
  .feature {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 12px;
    color: #666;
  }
  
  .feature-icon {
    font-size: 24px;
    margin-bottom: 5px;
  }
  
  .property-description {
    color: #666;
    font-size: 14px;
    line-height: 1.6;
    margin-bottom: 30px;
    opacity: 0;
    animation: fadeIn 0.5s 0.6s forwards;
  }
  
  .contact-button {
    width: 100%;
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    color: white;
    border: none;
    padding: 15px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
    transition: transform 0.2s, box-shadow 0.2s;
    opacity: 0;
    animation: fadeIn 0.5s 0.7s forwards;
  }
  
  .contact-button:active {
    transform: scale(0.98);
    box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
  }
  
  .contact-form {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    z-index: 20;
    transform: translateY(100%);
    transition: transform 0.3s ease-in-out;
    padding: 20px;
    display: flex;
    flex-direction: column;
  }
  
  .contact-form.show {
    transform: translateY(0);
  }
  
  .form-header {
    display: flex;
    align-items: center;
    margin-bottom: 30px;
  }
  
  .form-back {
    background: none;
    border: none;
    font-size: 24px;
    margin-right: 15px;
    cursor: pointer;
    color: #333;
  }
  
  .form-title {
    font-size: 20px;
    font-weight: 600;
    color: #333;
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  .form-label {
    display: block;
    margin-bottom: 8px;
    color: #666;
    font-size: 14px;
    font-weight: 500;
  }
  
  .form-input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #eee;
    border-radius: 10px;
    font-size: 16px;
    font-family: inherit;
    transition: border-color 0.3s;
  }
  
  .form-input:focus {
    outline: none;
    border-color: #ff6b35;
  }
  
  .form-submit {
    width: 100%;
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    color: white;
    border: none;
    padding: 15px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
    margin-top: auto;
    margin-bottom: 20px;
  }
  
  .form-submit:active {
    transform: scale(0.98);
  }
  
  .whatsapp-notification-inner {
    position: absolute;
    top: 45px;
    left: 6px;
    right: 6px;
    background: #ffffff;
    color: #000;
    padding: 0;
    border-radius: 14px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.25), 0 2px 8px rgba(0,0,0,0.15);
    display: none;
    flex-direction: column;
    z-index: 1000;
    animation: slideDownBounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    cursor: pointer;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
    border: 1px solid rgba(0,0,0,0.08);
  }
  
  .whatsapp-notification-inner:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 32px rgba(0,0,0,0.3), 0 4px 12px rgba(0,0,0,0.2);
  }
  
  .whatsapp-notification-inner:active {
    transform: translateY(0);
  }
  
  .whatsapp-notification-inner.show {
    display: flex;
  }
  
  .notification-header {
    background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
    padding: 12px 14px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid rgba(0,0,0,0.05);
  }
  
  .notification-icon {
    width: 44px;
    height: 44px;
    background: rgba(255,255,255,0.25);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
    border: 2px solid rgba(255,255,255,0.3);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  
  .notification-content {
    flex: 1;
    min-width: 0;
  }
  
  .notification-title {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 2px;
    color: white;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }
  
  .notification-time {
    font-size: 11px;
    color: rgba(255,255,255,0.85);
    display: flex;
    align-items: center;
    gap: 4px;
  }
  
  .notification-body {
    padding: 12px 14px;
    background: #f0f0f0;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .notification-text {
    font-size: 13px;
    color: #4a4a4a;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.4;
    flex: 1;
  }
  
  .notification-badge {
    width: 8px;
    height: 8px;
    background: #25d366;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 4px rgba(37, 211, 102, 0.6);
  }
  
  @keyframes slideDownBounce {
    0% {
      transform: translateY(-120px) scale(0.9);
      opacity: 0;
    }
    60% {
      transform: translateY(8px) scale(1.02);
      opacity: 1;
    }
    100% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
  }
  
  .bottom-nav {
    position: absolute;
    bottom: 0;
    width: 100%;
    background: white;
    border-top: 1px solid #eee;
    display: flex;
    justify-content: space-around;
    padding: 10px 0;
    z-index: 10;
  }
  
  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #999;
    font-size: 12px;
    cursor: pointer;
  }
  
  .nav-item.active {
    color: #ff6b35;
  }
  
  .nav-icon {
    font-size: 20px;
    margin-bottom: 3px;
  }
  
  /* WhatsApp View (hidden initially) */
  .whatsapp-view {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
    z-index: 15;
  }
  
  .whatsapp-view.show {
    transform: translateX(0);
  }
  
  /* Client Final View (similar to agent initial state) */
  .client-final-view {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('images/tela-iphone2.png');
    background-size: 100% 100%;
    background-position: center;
    background-repeat: no-repeat;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    transition: opacity 2s ease-out;
  }
  
  .client-final-view::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: -1;
  }
  
  .client-final-header {
    text-align: center;
    background: rgba(0, 0, 0, 0.3);
    padding: 30px 40px;
    border-radius: 15px;
    border: groove;
  }
  
  .client-final-avatar {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
    border-radius: 50%;
    margin: 0 auto 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    color: white;
  }
  
  .client-final-name {
    font-size: 20px;
    font-weight: 600;
    color: white;
    margin-bottom: 5px;
  }
  
  .client-final-role {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.9);
  }
  
  /* ImobFlash Dashboard */
  .dashboard-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  
  .dashboard-logo {
    font-size: 24px;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .monitoring-status {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    opacity: 0.9;
  }
  
  .status-dots {
    display: flex;
    gap: 4px;
    align-items: center;
  }
  
  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #4caf50;
    animation: pulse 1.5s ease-in-out infinite;
  }
  
  .status-dot:nth-child(1) {
    animation-delay: 0s;
  }
  
  .status-dot:nth-child(2) {
    animation-delay: 0.3s;
  }
  
  .status-dot:nth-child(3) {
    animation-delay: 0.6s;
  }
  
  @keyframes pulse {
    0%, 100% {
      opacity: 0.3;
      transform: scale(1);
    }
    50% {
      opacity: 1;
      transform: scale(1.2);
    }
  }
  
  .dashboard-page-header {
    background: #f8f9fa;
    border-bottom: 1px solid #e0e0e0;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  
  .dashboard-page-title {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .dashboard-content {
    padding: 20px;
    height: calc(100% - 120px);
    overflow-y: auto;
  }
  
  .email-notification {
    background: #fff;
    border-left: 4px solid #667eea;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    animation: slideInRight 0.5s ease-out;
  }
  
  @keyframes slideInRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  .email-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }
  
  .email-icon {
    font-size: 24px;
  }
  
  .email-subject {
    font-weight: 600;
    color: #333;
    font-size: 14px;
  }
  
  .email-from {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
  }
  
  .email-body {
    font-size: 12px;
    color: #666;
    line-height: 1.5;
  }
  
  .email-datetime {
    font-size: 11px;
    color: #999;
    margin-bottom: 8px;
    font-weight: 500;
  }
  
  /* Reduced Lead Card (like email notification) */
  .lead-card-reduced {
    background: white;
    border-left: 4px solid #667eea;
    padding: 15px;
    padding-bottom: 40px;
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    animation: fadeInUp 0.5s ease-out;
    position: relative;
    min-height: 80px;
  }
  
  .lead-card-reduced .lead-header-reduced {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .lead-icon {
    font-size: 24px;
  }
  
  .lead-header-info {
    flex: 1;
  }
  
  .lead-name-reduced {
    font-weight: 600;
    color: #333;
    font-size: 14px;
    margin-bottom: 3px;
  }
  
  .lead-property-reduced {
    font-size: 12px;
    color: #666;
    margin-bottom: 3px;
  }
  
  .lead-origin {
    font-size: 11px;
    color: #999;
    margin-bottom: 3px;
  }
  
  .lead-datetime {
    font-size: 10px;
    color: #999;
  }
  
  .lead-score-status-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 5px;
  }
  
  .lead-score {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 12px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
  }
  
  .score-new {
    background: #2196f3;
    color: white;
  }
  
  .score-hot {
    background: #ff6b6b;
    color: white;
  }
  
  .score-warm {
    background: #ffa500;
    color: white;
  }
  
  .score-cold {
    background: #95a5a6;
    color: white;
  }
  
  .score-value {
    font-size: 14px;
  }
  
  .lead-status-small {
    font-size: 11px;
    color: #666;
    font-weight: 500;
  }
  
  .details-button-reduced {
    position: absolute;
    bottom: 10px;
    right: 15px;
    background: #667eea;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
    z-index: 2;
  }
  
  .details-button-reduced:hover {
    background: #5568d3;
  }
  
  /* Full Lead Card */
  .lead-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    animation: fadeInUp 0.5s ease-out;
    position: relative;
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .lead-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
  }
  
  .lead-name {
    font-size: 18px;
    font-weight: 600;
    color: #333;
  }
  
  .lead-score-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
  }
  
  .details-button {
    position: absolute;
    bottom: 15px;
    right: 20px;
    background: #667eea;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
  }
  
  .details-button:hover {
    background: #5568d3;
  }
  
  .lead-details-expanded {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease-out;
    margin-top: 15px;
  }
  
  .lead-details-expanded.show {
    max-height: 1000px;
  }
  
  .lead-details-content {
    padding-top: 15px;
    border-top: 1px solid #eee;
  }
  
  .lead-info {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 15px;
  }
  
  .info-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: #666;
  }
  
  .conversation-preview {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 15px;
    max-height: 150px;
    overflow-y: auto;
  }
  
  .conversation-item {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
    padding-left: 15px;
    position: relative;
  }
  
  .conversation-item::before {
    content: '‚Ä¢';
    position: absolute;
    left: 0;
    color: #667eea;
  }
  
  .status-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    margin-top: 10px;
  }
  
  .status-active {
    background: #4caf50;
    color: white;
  }
  
  .status-qualified {
    background: #2196f3;
    color: white;
  }
  
  /* Agent View */
  .agent-phone {
    width: 350px;
    height: 700px;
    background-color: transparent;
    border-radius: 0;
    box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    overflow: hidden;
    position: relative;
    border: none;
    padding: 0;
  }
  
  .agent-phone-frame {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    z-index: 0;
    pointer-events: none;
  }
  
  .agent-notification {
    position: absolute;
    top: 60px;
    left: 10px;
    right: 10px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    display: none;
    z-index: 10;
    cursor: pointer;
    animation: slideDown 0.3s ease-out;
  }
  
  .agent-notification.show {
    display: block;
  }
  
  @keyframes slideDown {
    from {
      transform: translateY(-100px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  .notification-content {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .notification-icon {
    font-size: 28px;
  }
  
  .notification-text {
    flex: 1;
  }
  
  .notification-title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 3px;
  }
  
  .notification-subtitle {
    font-size: 12px;
    opacity: 0.9;
  }
  
  .agent-home {
    padding: 20px;
    height: 100%;
    background: rgba(245, 245, 245, 0.95);
    overflow-y: auto;
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .agent-home.initial-state {
    background: rgba(0, 0, 0, 0.3);
  }
  
  .agent-header {
    text-align: center;
    margin-bottom: 30px;
  }
  
  .agent-home.initial-state .agent-header {
    background: rgba(0, 0, 0, 0.3);
    padding: 30px 40px;
    border-radius: 15px;
  }
  
  .agent-home.initial-state .agent-name {
    color: white;
  }
  
  .agent-home.initial-state .agent-role {
    color: rgba(255, 255, 255, 0.9);
  }
  
  .agent-avatar {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    margin: 0 auto 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    color: white;
  }
  
  .agent-name {
    font-size: 20px;
    font-weight: 600;
    color: #333;
    margin-bottom: 5px;
  }
  
  .agent-role {
    font-size: 14px;
    color: #666;
  }
  
  .dashboard-button {
    width: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 15px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }
  
  .lead-detail-view {
    display: none;
    padding: 20px;
    height: 100%;
    background: rgba(255, 255, 255, 0.95);
    overflow-y: auto;
    position: relative;
    z-index: 1;
  }
  
  .lead-detail-view.show {
    display: block;
  }
  
  .detail-header-agent {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    margin: -20px -20px 20px -20px;
  }
  
  .agent-avatar-small {
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
  }
  
  .agent-header-info {
    flex: 1;
  }
  
  .agent-name-small {
    font-size: 18px;
    font-weight: 600;
    color: white;
    margin-bottom: 2px;
  }
  
  .agent-role-small {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.9);
  }
  
  .detail-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .back-button {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #333;
  }
  
  .detail-title {
    font-size: 20px;
    font-weight: 600;
    color: #333;
  }
  
  .detail-section {
    margin-bottom: 25px;
  }
  
  .section-title {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #eee;
  }
  
  .conversation-full {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 15px;
    max-height: 300px;
    overflow-y: auto;
  }
  
  .conversation-message {
    background: white;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 10px;
    font-size: 13px;
    line-height: 1.5;
  }
  
  .message-ana {
    border-left: 3px solid #667eea;
  }
  
  .message-pedro {
    border-left: 3px solid #4caf50;
  }
  
  .action-button {
    width: 100%;
    background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
    color: white;
    border: none;
    padding: 15px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 20px;
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
  }
</style>
</head>
<body>

<div class="container">
  <!-- Cliente Pedro -->
  <div class="view-section">
    <div class="view-title">üë§ Cliente: Pedro</div>
    <div class="phone" id="clientPhone">
      <!-- Click Indicator -->
      <div class="click-indicator" id="clickIndicator"></div>
      
      <!-- Loading Screen -->
      <div class="loading-screen" id="loadingScreen">
        <div class="spinner"></div>
        <div style="color: #666; font-size: 14px;">A pesquisar im√≥veis...</div>
      </div>
      
      <!-- Portal View -->
      <div id="portalView">
        <!-- Portal Header -->
        <div class="portal-header">
          <div class="portal-logo">Idealista</div>
          <div class="search-icon">üîç</div>
        </div>
        
        <div class="search-bar" id="searchBar" style="display: none;">
          <span>üîç</span>
          <span>Lisboa, T2, at√© ‚Ç¨300.000</span>
        </div>
        
        <!-- Property List View -->
        <div class="property-list" id="propertyList">
          <div class="property-card" data-property="t2-roma">
            <div class="card-image" style="background-image: url('images/t2-roma.jpg'); background-size: cover; background-position: center;">
              <div class="card-badge">üì∑ 12 fotos</div>
            </div>
            <div class="card-content">
              <div class="card-price">‚Ç¨ 280.000</div>
              <div class="card-title">T2 Renovado - Av. Roma</div>
              <div class="card-location">üìç Avenida de Roma, Lisboa</div>
              <div class="card-features">
                <span>üõèÔ∏è 2</span>
                <span>üöø 1</span>
                <span>üìê 85 m¬≤</span>
              </div>
            </div>
          </div>
          
          <div class="property-card" data-property="t3-campolide">
            <div class="card-image" style="background-image: url('images/t3-campolide.jpg'); background-size: cover; background-position: center;">
              <div class="card-badge">üì∑ 15 fotos</div>
            </div>
            <div class="card-content">
              <div class="card-price">‚Ç¨ 320.000</div>
              <div class="card-title">T3 com Varanda - Campolide</div>
              <div class="card-location">üìç Campolide, Lisboa</div>
              <div class="card-features">
                <span>üõèÔ∏è 3</span>
                <span>üöø 2</span>
                <span>üìê 110 m¬≤</span>
              </div>
            </div>
          </div>
          
          <div class="property-card" data-property="t2-alvalade">
            <div class="card-image" style="background-image: url('images/t2-alvalade.jpg'); background-size: cover; background-position: center;">
              <div class="card-badge">üì∑ 18 fotos</div>
            </div>
            <div class="card-content">
              <div class="card-price">‚Ç¨ 295.000</div>
              <div class="card-title">T2 Renovado - Alvalade</div>
              <div class="card-location">üìç Alvalade, Lisboa</div>
              <div class="card-features">
                <span>üõèÔ∏è 2</span>
                <span>üöø 1</span>
                <span>üìê 90 m¬≤</span>
              </div>
            </div>
          </div>
          
          <div class="property-card" data-property="t2-marques">
            <div class="card-image" style="background-image: url('images/t2-marques.jpg'); background-size: cover; background-position: center;">
              <div class="card-badge">üì∑ 10 fotos</div>
            </div>
            <div class="card-content">
              <div class="card-price">‚Ç¨ 265.000</div>
              <div class="card-title">T2 - Marqu√™s de Pombal</div>
              <div class="card-location">üìç Marqu√™s de Pombal, Lisboa</div>
              <div class="card-features">
                <span>üõèÔ∏è 2</span>
                <span>üöø 1</span>
                <span>üìê 75 m¬≤</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Property Detail View -->
        <div class="property-detail" id="propertyDetail">
          <div class="image-gallery">
            <div class="gallery-container" id="galleryContainer">
              <div class="gallery-image sala"></div>
              <div class="gallery-image cozinha"></div>
              <div class="gallery-image fachada"></div>
              <div class="gallery-image banheiro"></div>
            </div>
            <button class="back-button" id="backBtn">‚Üê</button>
            <div class="gallery-dots" id="galleryDots">
              <div class="gallery-dot active" data-index="0"></div>
              <div class="gallery-dot" data-index="1"></div>
              <div class="gallery-dot" data-index="2"></div>
              <div class="gallery-dot" data-index="3"></div>
            </div>
          </div>
          
          <div class="property-details">
            <div class="property-price">‚Ç¨ 280.000</div>
            <div class="property-title">T2 Renovado - Av. Roma, Lisboa</div>
            <div class="property-location">Avenida de Roma, Lisboa</div>
            
            <div class="property-features">
              <div class="feature">
                <div class="feature-icon">üõèÔ∏è</div>
                <div>2 Quartos</div>
              </div>
              <div class="feature">
                <div class="feature-icon">üöø</div>
                <div>1 Casa de Banho</div>
              </div>
              <div class="feature">
                <div class="feature-icon">üìê</div>
                <div>85 m¬≤</div>
              </div>
            </div>
            
            <div class="property-description">
              Apartamento T2 completamente renovado na Avenida de Roma, zona privilegiada de Lisboa. Excelente exposi√ß√£o solar, acabamentos de qualidade e pronto a habitar. Pr√≥ximo de transportes, escolas e com√©rcio.
            </div>
            
            <button class="contact-button" id="contactBtn">
              üì± Pedir mais informa√ß√µes
            </button>
          </div>
        </div>
        
        <!-- Contact Form -->
        <div class="contact-form" id="contactForm">
          <div class="form-header">
            <button class="form-back" id="formBackBtn">‚Üê</button>
            <div class="form-title">Contactar Anunciante</div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Nome</label>
            <input type="text" class="form-input" id="nameInput" placeholder="O seu nome" value="">
          </div>
          
          <div class="form-group">
            <label class="form-label">Telefone</label>
            <input type="tel" class="form-input" id="phoneInput" placeholder="+351 912 345 678" value="">
          </div>
          
          <button class="form-submit" id="submitBtn">Enviar</button>
        </div>
        
        <!-- WhatsApp Notification Inside Phone -->
        <div class="whatsapp-notification-inner" id="whatsappNotificationInner">
          <div class="notification-header">
            <div class="notification-icon">üí¨</div>
            <div class="notification-content">
              <div class="notification-title">Ana (Assistente Virtual)</div>
              <div class="notification-time">
                <span>üïê</span>
                <span id="notificationTime">Agora</span>
              </div>
            </div>
          </div>
          <div class="notification-body">
            <div class="notification-text">Ol√° Pedro! üëã Sou a Ana...</div>
            <div class="notification-badge"></div>
          </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
          <div class="nav-item active">
            <div class="nav-icon">üè†</div>
            <div>Pesquisar</div>
          </div>
          <div class="nav-item">
            <div class="nav-icon">‚ù§Ô∏è</div>
            <div>Favoritos</div>
          </div>
          <div class="nav-item">
            <div class="nav-icon">üìã</div>
            <div>An√∫ncios</div>
          </div>
          <div class="nav-item">
            <div class="nav-icon">üë§</div>
            <div>Perfil</div>
          </div>
        </div>
      </div>
      
      <!-- Client Final View (similar to agent initial state) -->
      <div class="client-final-view" id="clientFinalView" style="display: none;">
        <div class="client-final-header">
          <div class="client-final-avatar">üë§</div>
          <div class="client-final-name">Pedro</div>
          <div class="client-final-role">Cliente</div>
        </div>
        
        <!-- WhatsApp Notification for Agent -->
        <div class="whatsapp-notification-inner" id="whatsappNotificationAgent" style="display: none;">
          <div class="notification-header">
            <div class="notification-icon">üí¨</div>
            <div class="notification-content">
              <div class="notification-title">Jo√£o Silva</div>
              <div class="notification-time">
                <span>üïê</span>
                <span id="notificationTimeAgent">Agora</span>
              </div>
            </div>
          </div>
          <div class="notification-body">
            <div class="notification-text">Ol√° Pedro! Sou o Jo√£o...</div>
            <div class="notification-badge">1</div>
          </div>
        </div>
      </div>
      
      <!-- WhatsApp View (Ana) -->
      <div class="whatsapp-view" id="whatsappView">
        <div class="header">
          <div class="avatar">üë©‚Äçüíª</div>
          <div class="info">
            <h3>Ana (Assistente Virtual)</h3>
            <p id="clientStatus">Online</p>
          </div>
        </div>
        
        <div class="chat-area" id="clientChat"></div>
        <div class="typing" id="clientTyping">Ana est√° a escrever...</div>

        <div class="input-area">
          <div style="font-size:20px; color:#999;">+</div>
          <div class="input-fake">Mensagem</div>
          <div style="font-size:20px; color:#075e54;">‚û§</div>
        </div>
      </div>
      
      <!-- WhatsApp View (Jo√£o - Agent) -->
      <div class="whatsapp-view" id="whatsappViewAgent" style="display: none;">
        <div class="header">
          <div class="avatar">üë®‚Äçüíº</div>
          <div class="info">
            <h3>Jo√£o Silva</h3>
            <p id="agentStatus">Online</p>
          </div>
        </div>
        
        <div class="chat-area" id="agentChat"></div>
        <div class="typing" id="agentTyping" style="display: none;">Jo√£o est√° a escrever...</div>

        <div class="input-area">
          <div style="font-size:20px; color:#999;">+</div>
          <div class="input-fake">Mensagem</div>
          <div style="font-size:20px; color:#075e54;">‚û§</div>
        </div>
      </div>
      
    </div>
  </div>

  <!-- ImobFlash Dashboard (Ana) -->
  <div class="view-section">
    <div class="view-title">ü§ñ ImobFlash Dashboard (Ana)</div>
    <div class="desktop">
      <div class="desktop-screen">
        <div class="dashboard-header">
          <div class="dashboard-logo">
            <span>ü§ñ</span>
            <span>ImobFlash</span>
          </div>
        </div>
        <div class="dashboard-page-header">
          <div class="dashboard-page-title">
            <span>üìä</span>
            <span>Atividade</span>
          </div>
          <div class="monitoring-status">
            <span>Monitorando emails</span>
            <div class="status-dots">
              <div class="status-dot"></div>
              <div class="status-dot"></div>
              <div class="status-dot"></div>
            </div>
          </div>          
        </div>
        <div class="dashboard-content" id="dashboardContent">
          <!-- Luana Menescal Card -->
          <div class="lead-card-reduced" id="luanaCard">
            <div class="lead-header-reduced">
              <div class="lead-icon">üë§</div>
              <div class="lead-header-info">
                <div class="lead-datetime">15/01/2024 - 14:30</div>
                <div class="lead-name-reduced">Luana Menescal</div>
                <div class="lead-property-reduced">T1 em Benfica, Lisboa</div>
                <div class="lead-origin">Origem: OLX</div>
              </div>
              <div class="lead-score-status-container">
                <div class="lead-score score-cold">
                  <span>‚ùÑÔ∏è</span>
                  <span class="score-value">5%</span>
                </div>
                <div class="lead-status-small">Sem resposta</div>
              </div>
            </div>
            <button class="details-button-reduced" data-card="luana">Detalhes</button>
            <div class="lead-details-expanded" id="luanaDetails">
              <div class="lead-details-content">
                <div class="lead-info">
                  <div class="info-item">
                    <span>üì±</span>
                    <span>+351 923 456 789</span>
                  </div>
                  <div class="info-item">
                    <span>üè†</span>
                    <span>T1 em Benfica, Lisboa</span>
                  </div>
                  <div class="info-item">
                    <span>üìß</span>
                    <span>Origem: OLX</span>
                  </div>
                </div>
                <div class="conversation-preview" id="luanaConversationPreview"></div>
                <div class="status-badge status-active">Sem resposta</div>
              </div>
            </div>
          </div>
          
          <!-- Luiz Eduardo Card -->
          <div class="lead-card-reduced" id="luizCard">
            <div class="lead-header-reduced">
              <div class="lead-icon">üë§</div>
              <div class="lead-header-info">
                <div class="lead-datetime">15/01/2024 - 16:45</div>
                <div class="lead-name-reduced">Luiz Eduardo</div>
                <div class="lead-property-reduced">T3 em Cascais</div>
                <div class="lead-origin">Origem: Idealista</div>
              </div>
              <div class="lead-score-status-container">
                <div class="lead-score score-warm">
                  <span>üî•</span>
                  <span class="score-value">60%</span>
                </div>
                <div class="lead-status-small">Lead qualificado</div>
              </div>
            </div>
            <button class="details-button-reduced" data-card="luiz">Detalhes</button>
            <div class="lead-details-expanded" id="luizDetails">
              <div class="lead-details-content">
                <div class="lead-info">
                  <div class="info-item">
                    <span>üì±</span>
                    <span>+351 934 567 890</span>
                  </div>
                  <div class="info-item">
                    <span>üè†</span>
                    <span>T3 em Cascais</span>
                  </div>
                  <div class="info-item">
                    <span>üìß</span>
                    <span>Origem: Idealista</span>
                  </div>
                </div>
                <div class="conversation-preview" id="luizConversationPreview"></div>
                <div class="status-badge status-active">Lead qualificado</div>
              </div>
            </div>
          </div>
          
          <div id="emailNotification" style="display: none;">
            <div class="email-notification">
              <div class="email-header">
                <div class="email-icon">üìß</div>
                <div>
                  <div class="email-subject">Novo contacto do Idealista</div>
                  <div class="email-from">De: Idealista &lt;noreply@idealista.pt&gt;</div>
                </div>
              </div>
              <div class="email-body">
                <div class="email-datetime" id="emailDateTime">15/01/2024 - 18:20</div>
                Cliente Pedro interessado no T2 em Lisboa (Av. Roma).<br>
                Contacto: +351 912 345 678
              </div>
            </div>
          </div>
          <div id="leadCard" style="display: none;">
            <div class="lead-card-reduced" id="pedroCard">
              <div class="lead-header-reduced">
                <div class="lead-icon">üë§</div>
                <div class="lead-header-info">
                  <div class="lead-datetime" id="pedroDateTime">15/01/2024 - 18:20</div>
                  <div class="lead-name-reduced">Pedro</div>
                  <div class="lead-property-reduced">T2 em Lisboa (Av. Roma)</div>
                  <div class="lead-origin">Origem: Idealista</div>
                </div>
                <div class="lead-score-status-container">
                  <div class="lead-score score-new" id="leadScore">
                    <span>üÜï</span>
                    <span class="score-value" id="scoreValue">NOVO</span>
                  </div>
                  <div class="lead-status-small" id="pedroStatus">Em conversa</div>
                </div>
              </div>
              <button class="details-button-reduced" id="pedroDetailsBtn" data-card="pedro">Detalhes</button>
              <div class="lead-details-expanded" id="pedroDetailsExpanded">
                <div class="lead-details-content">
                  <div class="lead-info">
                    <div class="info-item">
                      <span>üì±</span>
                      <span>+351 912 345 678</span>
                    </div>
                    <div class="info-item">
                      <span>üè†</span>
                      <span>T2 em Lisboa (Av. Roma)</span>
                    </div>
                    <div class="info-item">
                      <span>üìß</span>
                      <span>Origem: Idealista</span>
                    </div>
                  </div>
                  <div class="conversation-preview" id="conversationPreview"></div>
                  <div class="status-badge status-active" id="statusBadge">Em conversa</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Agente Jo√£o -->
  <div class="view-section">
    <div class="view-title">üë®‚Äçüíº Agente: Jo√£o Silva</div>
    <div class="agent-phone" id="agentPhone">
      <img src="images/tela-iphone.png" alt="iPhone" class="agent-phone-frame" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; z-index: 0; pointer-events: none;">
      <div class="agent-notification" id="agentNotification">
        <div class="notification-content">
          <div class="notification-icon">üîî</div>
          <div class="notification-text">
            <div class="notification-title">ImobFlash</div>
            <div class="notification-subtitle">Novo lead qualificado: Pedro</div>
          </div>
        </div>
      </div>
      
      <div class="agent-home initial-state" id="agentHome">
        <div class="agent-header">
          <div class="agent-avatar">üë®‚Äçüíº</div>
          <div class="agent-name">Jo√£o Silva</div>
          <div class="agent-role">Consultor Imobili√°rio</div>
        </div>
      </div>
      
      <div class="lead-detail-view" id="leadDetailView">
        <div class="detail-header-agent">
          <div class="agent-avatar-small">üë®‚Äçüíº</div>
          <div class="agent-header-info">
            <div class="agent-name-small">Jo√£o Silva</div>
            <div class="agent-role-small">Consultor Imobili√°rio</div>
          </div>
        </div>
        
        <div class="detail-header">
          <button class="back-button" id="backBtnAgent">‚Üê</button>
          <div class="detail-title">Lead: Pedro</div>
        </div>
        
        <div class="detail-section">
          <div class="section-title">Score do Lead</div>
          <div class="lead-score" id="detailScore" style="display: inline-block;">
            <span class="score-value" id="detailScoreValue">0</span>
            <span>üî•</span>
          </div>
        </div>
        
        <div class="detail-section">
          <div class="section-title">Informa√ß√µes</div>
          <div class="lead-info">
            <div class="info-item">
              <span>üì±</span>
              <span>+351 912 345 678</span>
            </div>
            <div class="info-item">
              <span>üè†</span>
              <span>T2 em Lisboa (Av. Roma)</span>
            </div>
            <div class="info-item">
              <span>üìß</span>
              <span>Origem: Idealista</span>
            </div>
            <div class="info-item">
              <span>üí¨</span>
              <span>Habita√ß√£o pr√≥pria</span>
            </div>
            <div class="info-item">
              <span>üìÖ</span>
              <span>Disponibilidade: S√°bado manh√£</span>
            </div>
          </div>
        </div>
        
        <div class="detail-section">
          <div class="section-title">Conversa Completa</div>
          <div class="conversation-full" id="conversationFull"></div>
        </div>
        
        <button class="action-button" id="chatButton">üí¨ Continuar Conversa no WhatsApp</button>
      </div>
    </div>
  </div>
</div>

<!-- Control Panel -->
<div class="control-panel">
  <button class="play-button" id="playBtn">
    ‚ñ∂Ô∏è PLAY
  </button>
  <div class="speed-control">
    <span class="speed-label">Velocidade:</span>
    <input type="number" class="speed-input" id="speedInput" value="1" min="0.1" max="10" step="0.1">
    <span class="speed-label">x</span>
  </div>
</div>

<script>
  // Portal elements
  const phone = document.getElementById('clientPhone');
  const clickIndicator = document.getElementById('clickIndicator');
  const loadingScreen = document.getElementById('loadingScreen');
  const portalView = document.getElementById('portalView');
  const whatsappView = document.getElementById('whatsappView');
  const propertyList = document.getElementById('propertyList');
  const propertyDetail = document.getElementById('propertyDetail');
  const searchBar = document.getElementById('searchBar');
  const contactBtn = document.getElementById('contactBtn');
  const backBtn = document.getElementById('backBtn');
  const contactForm = document.getElementById('contactForm');
  const formBackBtn = document.getElementById('formBackBtn');
  const submitBtn = document.getElementById('submitBtn');
  const notificationInner = document.getElementById('whatsappNotificationInner');
  const propertyCards = document.querySelectorAll('.property-card');
  const galleryContainer = document.getElementById('galleryContainer');
  const galleryDots = document.querySelectorAll('.gallery-dot');
  const nameInput = document.getElementById('nameInput');
  const phoneInput = document.getElementById('phoneInput');
  
  // Client Chat
  const clientChat = document.getElementById('clientChat');
  const clientTyping = document.getElementById('clientTyping');
  const clientStatus = document.getElementById('clientStatus');
  
  // Dashboard
  const dashboardContent = document.getElementById('dashboardContent');
  const emailNotification = document.getElementById('emailNotification');
  const leadCard = document.getElementById('leadCard');
  const leadScore = document.getElementById('leadScore');
  const scoreValue = document.getElementById('scoreValue');
  const conversationPreview = document.getElementById('conversationPreview');
  const statusBadge = document.getElementById('statusBadge');
  const pedroStatus = document.getElementById('pedroStatus');
  const pedroDetailsBtn = document.getElementById('pedroDetailsBtn');
  const pedroDetailsExpanded = document.getElementById('pedroDetailsExpanded');
  
  // Agent
  const agentNotification = document.getElementById('agentNotification');
  const agentHome = document.getElementById('agentHome');
  const leadDetailView = document.getElementById('leadDetailView');
  const backBtnAgent = document.getElementById('backBtnAgent');
  const chatButton = document.getElementById('chatButton');
  const detailScore = document.getElementById('detailScore');
  const detailScoreValue = document.getElementById('detailScoreValue');
  const conversationFull = document.getElementById('conversationFull');
  
  const playBtn = document.getElementById('playBtn');
  const speedInput = document.getElementById('speedInput');
  
  let allTimeouts = [];
  let currentScore = 0;
  let conversationLog = [];
  let currentImageIndex = 0;
  let galleryInterval;
  let portalFlowStarted = false;
  let flowCompleted = false; // Track if flow has completed
  let flowStarted = false; // Track if flow has been started by user
  
  // Speed and play control
  let animationSpeed = 1; // 1x = normal speed
  let isPaused = false;
  let pausedTimeouts = []; // Store paused timeouts
  
  // Load speed from localStorage or use default
  const savedSpeed = localStorage.getItem('animationSpeed');
  if (savedSpeed) {
    animationSpeed = parseFloat(savedSpeed);
    speedInput.value = animationSpeed;
  } else {
    animationSpeed = parseFloat(speedInput.value) || 1;
  }
  
  // Apply speed to delay
  function getSpeedDelay(delay) {
    if (delay === 0) return 0;
    return Math.max(1, delay / animationSpeed); // Minimum 1ms
  }
  
  let activeIntervals = []; // Track active intervals for pause/resume
  let pauseStartTime = null;
  let pausedGalleryInterval = null; // Store gallery interval state
  
  // Wrapper for setTimeout that respects speed and pause
  function createSpeedTimeout(func, delay) {
    if (isPaused) {
      // Store for later execution with original delay
      const timeoutData = { 
        func, 
        originalDelay: delay, 
        startTime: Date.now(), 
        remaining: delay,
        id: Date.now() + Math.random()
      };
      pausedTimeouts.push(timeoutData);
      return timeoutData.id;
    }
    
    const adjustedDelay = getSpeedDelay(delay);
    const timeout = setTimeout(func, adjustedDelay);
    allTimeouts.push({ timeout, originalDelay: delay, startTime: Date.now(), func });
    return timeout;
  }
  
  // Play/Pause/Restart control - unified button
  playBtn.addEventListener('click', function() {
    // If button shows REINICIAR, reload page
    if (flowCompleted || playBtn.textContent.includes('REINICIAR')) {
      location.reload();
      return;
    }
    
    // If flow hasn't started yet, start it
    if (!flowStarted) {
      flowStarted = true;
      isPaused = false;
      playBtn.textContent = '‚è∏Ô∏è PAUSE';
      playBtn.classList.remove('paused');
      
      // Remove initial background from agent view
      const agentHome = document.getElementById('agentHome');
      if (agentHome) {
        agentHome.classList.remove('initial-state');
        agentHome.style.background = 'rgba(245, 245, 245, 0.95)';
      }
      
      // Highlight client mockup as active
      const clientViewSection = document.querySelector('.view-section:first-of-type');
      if (clientViewSection) {
        clientViewSection.classList.add('active');
      }
      
      startPortalFlow();
      return;
    }
    
    // If currently showing PAUSE (flow is running), pause it
    if (!isPaused && playBtn.textContent.includes('PAUSE')) {
      isPaused = true;
      
      // Pause: save current state of all timeouts
      pauseStartTime = Date.now();
      pausedTimeouts = [];
      
      // Save all active timeouts with their remaining time
      allTimeouts.forEach((timeoutObj, index) => {
        if (timeoutObj.timeout) {
          const elapsed = Date.now() - timeoutObj.startTime;
          const remaining = Math.max(0, (timeoutObj.originalDelay / animationSpeed) - elapsed);
          pausedTimeouts.push({
            func: timeoutObj.func || (() => {}),
            originalDelay: timeoutObj.originalDelay,
            remaining: remaining,
            id: timeoutObj.id || index
          });
          clearTimeout(timeoutObj.timeout);
        }
      });
      
      allTimeouts = [];
      
      // Save gallery interval state
      if (galleryInterval) {
        pausedGalleryInterval = galleryInterval;
        stopGalleryAuto();
      }
      
      // Clear and save intervals
      activeIntervals.forEach(interval => clearInterval(interval));
      activeIntervals = [];
      
      // Change button to REINICIAR
      playBtn.textContent = 'üîÑ REINICIAR';
      playBtn.classList.add('restart');
      playBtn.classList.remove('paused');
    }
  });
  
  // Speed control - apply without reload
  speedInput.addEventListener('input', function() {
    const newSpeed = parseFloat(this.value);
    if (!isNaN(newSpeed) && newSpeed >= 0.1 && newSpeed <= 10) {
      const oldSpeed = animationSpeed;
      animationSpeed = newSpeed;
      localStorage.setItem('animationSpeed', newSpeed);
      
      // Adjust remaining time of active timeouts based on speed change
      if (!isPaused && allTimeouts.length > 0) {
        allTimeouts.forEach(timeoutObj => {
          if (timeoutObj.timeout) {
            const elapsed = Date.now() - timeoutObj.startTime;
            const oldRemaining = Math.max(0, (timeoutObj.originalDelay / oldSpeed) - elapsed);
            const newRemaining = oldRemaining * (oldSpeed / newSpeed);
            
            // Clear old timeout and create new one with adjusted delay
            clearTimeout(timeoutObj.timeout);
            const newTimeout = setTimeout(timeoutObj.func, newRemaining);
            timeoutObj.timeout = newTimeout;
            timeoutObj.startTime = Date.now();
          }
        });
      }
    }
  });
  
  speedInput.addEventListener('change', function() {
    const newSpeed = parseFloat(this.value);
    if (newSpeed >= 0.1 && newSpeed <= 10) {
      animationSpeed = newSpeed;
      localStorage.setItem('animationSpeed', newSpeed);
    } else {
      this.value = animationSpeed; // Revert invalid value
    }
  });
  
  // Portal functions
  function showClick(x, y) {
    const phoneRect = phone.getBoundingClientRect();
    const clickX = x - phoneRect.left;
    const clickY = y - phoneRect.top;
    
    clickIndicator.style.left = clickX + 'px';
    clickIndicator.style.top = clickY + 'px';
    clickIndicator.style.display = 'block';
    
    setTimeout(() => {
      clickIndicator.style.display = 'none';
    }, 400);
  }
  
  function showClickAgent(x, y) {
    const agentPhone = document.getElementById('agentPhone');
    if (!agentPhone) return;
    
    const phoneRect = agentPhone.getBoundingClientRect();
    const clickX = x - phoneRect.left;
    const clickY = y - phoneRect.top;
    
    // Create click indicator for agent phone
    let agentClickIndicator = document.getElementById('agentClickIndicator');
    if (!agentClickIndicator) {
      agentClickIndicator = document.createElement('div');
      agentClickIndicator.id = 'agentClickIndicator';
      agentClickIndicator.className = 'click-indicator';
      agentPhone.appendChild(agentClickIndicator);
    }
    
    agentClickIndicator.style.left = clickX + 'px';
    agentClickIndicator.style.top = clickY + 'px';
    agentClickIndicator.style.display = 'block';
    
    setTimeout(() => {
      agentClickIndicator.style.display = 'none';
    }, 400);
  }
  
  function simulateClick(element, delay = 0) {
    createSpeedTimeout(() => {
      const rect = element.getBoundingClientRect();
      const x = rect.left + rect.width / 2;
      const y = rect.top + rect.height / 2;
      showClick(x, y);
      
      createSpeedTimeout(() => {
        element.click();
      }, 200);
    }, delay);
  }
  
  function updateGallery(index) {
    currentImageIndex = index;
    galleryContainer.style.transform = `translateX(-${index * 25}%)`;
    galleryDots.forEach((dot, i) => {
      dot.classList.toggle('active', i === index);
    });
  }
  
  function startGalleryAuto() {
    const baseInterval = 2000;
    const adjustedInterval = getSpeedDelay(baseInterval);
    // Clear any existing interval first
    if (galleryInterval) {
      clearInterval(galleryInterval);
    }
    galleryInterval = setInterval(() => {
      if (!isPaused) {
        currentImageIndex = (currentImageIndex + 1) % 4;
        updateGallery(currentImageIndex);
      }
    }, adjustedInterval);
  }
  
  function stopGalleryAuto() {
    clearInterval(galleryInterval);
  }
  
  function typeText(input, text, speed = 50) {
    return new Promise((resolve) => {
      input.value = '';
      let index = 0;
      const adjustedSpeed = getSpeedDelay(speed);
      const typeInterval = setInterval(() => {
        if (isPaused) return; // Don't type when paused
        if (index < text.length) {
          input.value += text[index];
          index++;
          input.dispatchEvent(new Event('input', { bubbles: true }));
        } else {
          clearInterval(typeInterval);
          resolve();
        }
      }, adjustedSpeed);
    });
  }
  
  function switchToWhatsApp() {
    portalView.style.display = 'none';
    whatsappView.classList.add('show');
    // Start WhatsApp conversation flow
    startWhatsAppFlow();
  }
  
  // Portal flow
  function startPortalFlow() {
    const timeout1 = createSpeedTimeout(() => {
      loadingScreen.classList.add('hidden');
      searchBar.style.display = 'flex';
      
      const timeout2 = createSpeedTimeout(() => {
        const listContainer = propertyList;
        let scrollPosition = 0;
        const scrollInterval = setInterval(() => {
          if (isPaused) return; // Don't scroll when paused
          scrollPosition += 2;
          listContainer.scrollTop = scrollPosition;
          if (scrollPosition >= 100) {
            clearInterval(scrollInterval);
            createSpeedTimeout(() => {
              simulateClick(propertyCards[0], 500);
            }, 500);
          }
        }, Math.max(1, getSpeedDelay(20)));
      }, 1000);
      if (timeout2) allTimeouts.push(timeout2);
    }, 2000);
    if (timeout1) allTimeouts.push(timeout1);
  }
  
  // Portal event handlers
  propertyCards.forEach(card => {
    card.addEventListener('click', function() {
      propertyList.style.transform = 'translateX(-100%)';
      propertyDetail.classList.add('show');
      startGalleryAuto();
      
      createSpeedTimeout(() => {
        stopGalleryAuto();
        const detailContainer = propertyDetail;
        let scrollPos = 0;
        const maxScroll = detailContainer.scrollHeight - detailContainer.clientHeight;
        const scrollInterval = setInterval(() => {
          if (isPaused) return; // Don't scroll when paused
          scrollPos += 5;
          detailContainer.scrollTop = scrollPos;
          if (scrollPos >= maxScroll) {
            clearInterval(scrollInterval);
            createSpeedTimeout(() => {
              simulateClick(contactBtn, 500);
            }, 500);
          }
        }, Math.max(1, getSpeedDelay(20)));
      }, 8000);
    });
  });
  
  backBtn.addEventListener('click', function() {
    stopGalleryAuto();
    propertyDetail.classList.remove('show');
    createSpeedTimeout(() => {
      propertyList.style.transform = 'translateX(0)';
    }, 300);
  });
  
  contactBtn.addEventListener('click', function() {
    propertyDetail.style.display = 'none';
    contactForm.classList.add('show');
    
    createSpeedTimeout(async () => {
      await typeText(nameInput, 'Pedro', 80);
      createSpeedTimeout(async () => {
        await typeText(phoneInput, '+351 912 345 678', 60);
        createSpeedTimeout(() => {
          simulateClick(submitBtn, 500);
        }, 500);
      }, 300);
    }, 500);
  });
  
  formBackBtn.addEventListener('click', function() {
    contactForm.classList.remove('show');
    createSpeedTimeout(() => {
      propertyDetail.style.display = 'block';
    }, 300);
  });
  
  submitBtn.addEventListener('click', function() {
    submitBtn.innerHTML = '‚è≥ A enviar...';
    submitBtn.disabled = true;
    
    createSpeedTimeout(() => {
      contactForm.classList.remove('show');
      // Trigger email to dashboard
      emailNotification.style.display = 'block';
      
      // Set current date and time for email
      const now = new Date();
      const dateStr = now.getDate().toString().padStart(2, '0') + '/' + 
                     (now.getMonth() + 1).toString().padStart(2, '0') + '/' + 
                     now.getFullYear();
      const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                     now.getMinutes().toString().padStart(2, '0');
      const emailDateTime = document.getElementById('emailDateTime');
      if (emailDateTime) {
        emailDateTime.textContent = dateStr + ' - ' + timeStr;
      }
      
      // Show Pedro card with NOVO score
      createSpeedTimeout(() => {
        leadCard.style.display = 'block';
        // Set current date and time for Pedro card
        const pedroDateTime = document.getElementById('pedroDateTime');
        if (pedroDateTime) {
          pedroDateTime.textContent = dateStr + ' - ' + timeStr;
        }
        
        // Scroll dashboard to show Pedro card and cards below (when in conversation)
        createSpeedTimeout(() => {
          const dashboardContent = document.getElementById('dashboardContent');
          if (dashboardContent) {
            // Wait a bit for card to render, then scroll
            createSpeedTimeout(() => {
              const pedroCard = document.getElementById('pedroCard');
              if (pedroCard) {
                // Scroll to show Pedro card and ensure we can see more content below
                // Scroll enough to show cards 3 and 4 (if they exist) or at least show Pedro card well
                let currentScroll = dashboardContent.scrollTop;
                const targetScroll = Math.min(
                  pedroCard.offsetTop + pedroCard.offsetHeight - dashboardContent.clientHeight + 100,
                  dashboardContent.scrollHeight - dashboardContent.clientHeight
                );
                const scrollInterval = setInterval(() => {
                  if (isPaused) {
                    clearInterval(scrollInterval);
                    return;
                  }
                  const scrollStep = 6;
                  currentScroll += scrollStep;
                  dashboardContent.scrollTop = currentScroll;
                  if (currentScroll >= targetScroll || currentScroll >= dashboardContent.scrollHeight - dashboardContent.clientHeight) {
                    clearInterval(scrollInterval);
                  }
                }, getSpeedDelay(10));
              }
            }, 200);
          }
        }, 300);
      }, 500);
      
      createSpeedTimeout(() => {
        notificationInner.classList.add('show');
        // Set notification time
        const now = new Date();
        const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                       now.getMinutes().toString().padStart(2, '0');
        const notificationTimeEl = document.getElementById('notificationTime');
        if (notificationTimeEl) {
          notificationTimeEl.textContent = timeStr;
        }
        createSpeedTimeout(() => {
          simulateClick(notificationInner, 500);
        }, 2000);
      }, 500);
    }, 1500);
  });
  
  notificationInner.addEventListener('click', function() {
    switchToWhatsApp();
  });
  
  // Score calculation
  function updateScore(points) {
    currentScore += points;
    
    // Get score icon based on value
    function getScoreIcon(score) {
      if (score >= 70) return 'üî•';
      if (score >= 40) return 'üî•';
      return '‚ùÑÔ∏è';
    }
    
    // If score was "NOVO", change to actual value
    if (scoreValue.textContent === 'NOVO') {
      const scoreIcon = getScoreIcon(currentScore);
      const scoreClass = currentScore >= 70 ? 'score-hot' : currentScore >= 40 ? 'score-warm' : 'score-cold';
      leadScore.className = `lead-score ${scoreClass}`;
      leadScore.innerHTML = `<span>${scoreIcon}</span><span class="score-value">${currentScore}%</span>`;
      scoreValue.textContent = currentScore + '%';
    } else {
      // Update existing score - extract current percentage
      const currentText = scoreValue.textContent;
      const currentPercent = parseInt(currentText.replace('%', '')) || currentScore;
      const newPercent = currentPercent + points;
      currentScore = newPercent; // Update global score
      const scoreIcon = getScoreIcon(newPercent);
      const scoreClass = newPercent >= 70 ? 'score-hot' : newPercent >= 40 ? 'score-warm' : 'score-cold';
      leadScore.className = `lead-score ${scoreClass}`;
      leadScore.innerHTML = `<span>${scoreIcon}</span><span class="score-value">${newPercent}%</span>`;
      scoreValue.textContent = newPercent + '%';
    }
    
    detailScoreValue.textContent = currentScore + '%';
    const scoreClass = currentScore >= 70 ? 'score-hot' : currentScore >= 40 ? 'score-warm' : 'score-cold';
    const scoreIcon = getScoreIcon(currentScore);
    detailScore.className = `lead-score ${scoreClass}`;
    detailScore.innerHTML = `<span class="score-value">${currentScore}%</span> <span>${scoreIcon}</span>`;
  }
  
  // Toggle details function
  function toggleDetails(cardId) {
    const detailsElement = document.getElementById(cardId + 'Details');
    if (detailsElement) {
      detailsElement.classList.toggle('show');
    }
  }
  
  // Expand details function (for auto-expand)
  function expandPedroDetails() {
    pedroDetailsExpanded.classList.add('show');
    
    // First: Scroll dashboard to bottom completely
    createSpeedTimeout(() => {
      const dashboardContent = document.getElementById('dashboardContent');
      if (dashboardContent) {
        const maxScroll = dashboardContent.scrollHeight - dashboardContent.clientHeight;
        let currentScroll = dashboardContent.scrollTop;
        let scrollComplete = false;
        
        const scrollInterval = setInterval(() => {
          if (isPaused) {
            clearInterval(scrollInterval);
            const idx = activeIntervals.indexOf(scrollInterval);
            if (idx > -1) activeIntervals.splice(idx, 1);
            return;
          }
          const scrollStep = 8;
          currentScroll += scrollStep;
          dashboardContent.scrollTop = currentScroll;
          
          // Check if we've reached the bottom
          if (currentScroll >= maxScroll - 2) { // -2 for rounding
            clearInterval(scrollInterval);
            const idx = activeIntervals.indexOf(scrollInterval);
            if (idx > -1) activeIntervals.splice(idx, 1);
            scrollComplete = true;
            dashboardContent.scrollTop = maxScroll; // Ensure we're at the very bottom
            
            // Only after dashboard scroll is complete, scroll conversation preview
            createSpeedTimeout(() => {
              const conversationPreview = document.getElementById('conversationPreview');
              if (conversationPreview && conversationPreview.scrollHeight > conversationPreview.clientHeight) {
                const previewMaxScroll = conversationPreview.scrollHeight - conversationPreview.clientHeight;
                let previewScroll = conversationPreview.scrollTop;
                const previewScrollInterval = setInterval(() => {
                  if (isPaused) {
                    clearInterval(previewScrollInterval);
                    return;
                  }
                  previewScroll += 5;
                  conversationPreview.scrollTop = previewScroll;
                  if (previewScroll >= previewMaxScroll) {
                    clearInterval(previewScrollInterval);
                    conversationPreview.scrollTop = previewMaxScroll; // Ensure at bottom
                  }
                }, getSpeedDelay(10));
                activeIntervals.push(previewScrollInterval);
              } else if (conversationPreview) {
                // If no scroll needed, just ensure it's at bottom
                conversationPreview.scrollTop = conversationPreview.scrollHeight;
              }
            }, 100);
          }
        }, getSpeedDelay(10));
        activeIntervals.push(scrollInterval); // Track interval for pause/resume
      }
    }, 100);
  }
  
  // Handle details button clicks for all cards
  document.querySelectorAll('.details-button-reduced').forEach(button => {
    button.addEventListener('click', function() {
      const cardId = this.getAttribute('data-card');
      toggleDetails(cardId);
    });
  });
  
  // Add to conversation log
  function addToConversationLog(sender, message) {
    conversationLog.push({ sender, message, time: new Date() });
    
    // Update preview
    const previewItem = document.createElement('div');
    previewItem.className = 'conversation-item';
    previewItem.textContent = `${sender}: ${message.substring(0, 50)}...`;
    conversationPreview.appendChild(previewItem);
    
    // Update full conversation
    const fullItem = document.createElement('div');
    fullItem.className = `conversation-message message-${sender === 'Ana' ? 'ana' : 'pedro'}`;
    fullItem.innerHTML = `<strong>${sender}:</strong> ${message}`;
    conversationFull.appendChild(fullItem);
    conversationFull.scrollTop = conversationFull.scrollHeight;
  }
  
  // Start WhatsApp flow (after portal)
  function startWhatsAppFlow() {
    // Ana starts conversation
    createSpeedTimeout(() => {
      addClientMessage("Ol√° Pedro! üëã Sou a Ana, assistente do consultor Jo√£o Silva.", 'received');
      addToConversationLog('Ana', 'Ol√° Pedro! üëã Sou a Ana, assistente do consultor Jo√£o Silva.');
      updateScore(5); // Initial contact
    }, 1000);
    
    createSpeedTimeout(() => {
      addClientMessage("Recebi o seu contacto pelo Idealista sobre o <b>T2 em Lisboa (Av. Roma)</b>. <a href='#' style='color: #075e54; text-decoration: underline;'>Ver an√∫ncio</a>", 'received');
      addToConversationLog('Ana', 'Recebi o seu contacto pelo Idealista sobre o T2 em Lisboa (Av. Roma).');
    }, 3000);
    
    createSpeedTimeout(() => {
      addClientMessage("O Jo√£o est√° em visitas, mas pediu para lhe adiantar a planta.", 'received');
      addToConversationLog('Ana', 'O Jo√£o est√° em visitas, mas pediu para lhe adiantar a planta.');
    }, 5000);
    
    createSpeedTimeout(() => {
      addClientMessage("Ol√°, sim, pode mandar.", 'sent');
      addToConversationLog('Pedro', 'Ol√°, sim, pode mandar.');
      updateScore(10); // Client responded - changes from NOVO to actual score (10%)
      
      // Scroll dashboard when Pedro starts conversation
      createSpeedTimeout(() => {
        const dashboardContent = document.getElementById('dashboardContent');
        if (dashboardContent) {
          const pedroCard = document.getElementById('pedroCard');
          if (pedroCard) {
            // Scroll to show Pedro card and cards below
            let currentScroll = dashboardContent.scrollTop;
            const targetScroll = Math.min(
              pedroCard.offsetTop + pedroCard.offsetHeight - dashboardContent.clientHeight + 150,
              dashboardContent.scrollHeight - dashboardContent.clientHeight
            );
            const scrollInterval = setInterval(() => {
              if (isPaused) {
                clearInterval(scrollInterval);
                return;
              }
              const scrollStep = 6;
              currentScroll += scrollStep;
              dashboardContent.scrollTop = currentScroll;
              if (currentScroll >= targetScroll || currentScroll >= dashboardContent.scrollHeight - dashboardContent.clientHeight) {
                clearInterval(scrollInterval);
              }
            }, getSpeedDelay(10));
          }
        }
      }, 500);
    }, 7000);
    
    createSpeedTimeout(() => {
      addClientMessage("Aqui est√°: üìÑ [Planta_T2_Roma.pdf]", 'received');
      addToConversationLog('Ana', 'Aqui est√°: Planta_T2_Roma.pdf');
    }, 9000);
    
    createSpeedTimeout(() => {
      addClientMessage("Para adiantar: esta compra seria para <b>habita√ß√£o pr√≥pria</b> ou investimento?", 'received');
      addToConversationLog('Ana', 'Para adiantar: esta compra seria para habita√ß√£o pr√≥pria ou investimento?');
    }, 11000);
    
    createSpeedTimeout(() => {
      addClientMessage("Seria para mim, habita√ß√£o pr√≥pria.", 'sent');
      addToConversationLog('Pedro', 'Seria para mim, habita√ß√£o pr√≥pria.');
      updateScore(15); // Qualified need
    }, 13000);
    
    createSpeedTimeout(() => {
      addClientMessage("Perfeito. E j√° tem a <b>pr√©-aprova√ß√£o banc√°ria</b> tratada ou vai precisar de ajuda?", 'received');
      addToConversationLog('Ana', 'Perfeito. E j√° tem a pr√©-aprova√ß√£o banc√°ria tratada ou vai precisar de ajuda?');
    }, 15000);
    
    createSpeedTimeout(() => {
      addClientMessage("Ainda n√£o fui ao banco, vou precisar tratar disso.", 'sent');
      addToConversationLog('Pedro', 'Ainda n√£o fui ao banco, vou precisar tratar disso.');
      updateScore(10); // Needs help
    }, 17000);
    
    createSpeedTimeout(() => {
      addClientMessage("Entendido. O Jo√£o pode ajudar com isso.", 'received');
      addToConversationLog('Ana', 'Entendido. O Jo√£o pode ajudar com isso.');
    }, 19000);
    
    createSpeedTimeout(() => {
      addClientMessage("Qual a sua melhor <b>disponibilidade</b> para agendar uma visita ao im√≥vel?", 'received');
      addToConversationLog('Ana', 'Qual a sua melhor disponibilidade para agendar uma visita ao im√≥vel?');
    }, 21000);
    
    createSpeedTimeout(() => {
      addClientMessage("Prefiro fins de semana, s√°bado de manh√£ seria ideal.", 'sent');
      addToConversationLog('Pedro', 'Prefiro fins de semana, s√°bado de manh√£ seria ideal.');
      updateScore(20); // Availability provided
    }, 23000);
    
    createSpeedTimeout(() => {
      addClientMessage("Pedro, o Jo√£o tem tamb√©m um <b>T2 renovado em Alvalade</b> similar. Quer receber as fotos para aproveitar a visita?", 'received');
      addToConversationLog('Ana', 'Pedro, o Jo√£o tem tamb√©m um T2 renovado em Alvalade similar. Quer receber as fotos?');
    }, 25000);
    
    createSpeedTimeout(() => {
      addClientMessage("Sim, por favor. Alvalade interessa.", 'sent');
      addToConversationLog('Pedro', 'Sim, por favor. Alvalade interessa.');
      updateScore(15); // Interested in more properties
    }, 27000);
    
    createSpeedTimeout(() => {
      addClientMessage("T2 em Alvalade (Av. Luis Sim√µes). <a href='#' style='color: #075e54; text-decoration: underline;'>Ver an√∫ncio</a>", 'received');
      addToConversationLog('Ana', 'T2 em Alvalade (Av. Luis Sim√µes). Ver an√∫ncio');
    }, 29000);
    
    createSpeedTimeout(() => {
      addClientMessage("Registado! ‚úÖ Passei o resumo urgente ao Jo√£o. Ele vai ligar-lhe em breve para agendar visita aos dois. Obrigada!", 'received');
      addToConversationLog('Ana', 'Registado! ‚úÖ Passei o resumo urgente ao Jo√£o.');
      updateScore(10); // Qualified lead
      
      statusBadge.textContent = 'Lead Qualificado';
      statusBadge.className = 'status-badge status-qualified';
      if (pedroStatus) {
        pedroStatus.textContent = 'Lead Qualificado';
      }
      
      // Transition client view to final state (similar to agent initial state)
      setTimeout(() => {
        const whatsappView = document.getElementById('whatsappView');
        const clientFinalView = document.getElementById('clientFinalView');
        if (whatsappView && clientFinalView) {
          // Fade out WhatsApp view
          whatsappView.style.transition = 'opacity 2s ease-out';
          whatsappView.style.opacity = '0';
          
          // After fade out, show final view
          setTimeout(() => {
            whatsappView.style.display = 'none';
            clientFinalView.style.display = 'flex';
            clientFinalView.style.opacity = '0';
            
            // Fade in final view
            setTimeout(() => {
              clientFinalView.style.transition = 'opacity 2s ease-out';
              clientFinalView.style.opacity = '1';
            }, 50);
          }, 2000);
        }
      }, 1500); // Wait 1.5 seconds after last message
      
      // Expand details automatically after conversation preview is populated
      createSpeedTimeout(() => {
        simulateClick(pedroDetailsBtn, 500);
        createSpeedTimeout(() => {
          expandPedroDetails();
        }, 300);
      }, 1000);
      
      // Notify agent in parallel (using fixed delays, ignoring speed setting - slower pace)
      // Switch highlight from client to agent when notification appears
      setTimeout(() => {
        const clientViewSection = document.querySelector('.view-section:first-of-type');
        const agentViewSection = document.querySelector('.view-section:last-of-type');
        if (clientViewSection) {
          clientViewSection.classList.remove('active');
        }
        if (agentViewSection) {
          agentViewSection.classList.add('active');
        }
      }, 2000); // Switch highlight 2 seconds before notification (1 second before fade starts)
      
      setTimeout(() => {
        // Fade out agent home panel before showing notification (3 seconds - slower)
        const agentHome = document.getElementById('agentHome');
        if (agentHome) {
          agentHome.style.transition = 'opacity 3s ease-out';
          agentHome.style.opacity = '0';
          
          // After fade out completes (3 seconds), show notification
          setTimeout(() => {
            agentHome.style.display = 'none';
            agentNotification.classList.add('show');
            
            // Keep notification visible for 3 seconds (slower), then auto-click
            setTimeout(() => {
              // Simulate click on notification with visual indicator
              const rect = agentNotification.getBoundingClientRect();
              const x = rect.left + rect.width / 2;
              const y = rect.top + rect.height / 2;
              showClickAgent(x, y);
              
              setTimeout(() => {
                agentNotification.classList.remove('show');
                agentHome.style.display = 'none';
                leadDetailView.classList.add('show');
                
                // After 2 seconds, scroll to bottom and scroll conversation
                setTimeout(() => {
                  // Scroll lead detail view to bottom
                  const maxScroll = leadDetailView.scrollHeight - leadDetailView.clientHeight;
                  let currentScroll = leadDetailView.scrollTop;
                  const scrollInterval = setInterval(() => {
                    const scrollStep = 8;
                    currentScroll += scrollStep;
                    leadDetailView.scrollTop = currentScroll;
                    if (currentScroll >= maxScroll) {
                      clearInterval(scrollInterval);
                      leadDetailView.scrollTop = maxScroll;
                      
                      // Also scroll conversation full
                      const conversationFull = document.getElementById('conversationFull');
                      if (conversationFull && conversationFull.scrollHeight > conversationFull.clientHeight) {
                        const fullMaxScroll = conversationFull.scrollHeight - conversationFull.clientHeight;
                        let fullScroll = conversationFull.scrollTop;
                        const fullScrollInterval = setInterval(() => {
                          const scrollStep = 5;
                          fullScroll += scrollStep;
                          conversationFull.scrollTop = fullScroll;
                          if (fullScroll >= fullMaxScroll) {
                            clearInterval(fullScrollInterval);
                            conversationFull.scrollTop = fullMaxScroll;
                            
                            // After scrolls complete, wait 2 seconds and click button
                            setTimeout(() => {
                              simulateClick(chatButton, 500);
                            }, 2000);
                          }
                        }, 10);
                      } else {
                        // If no conversation scroll needed, just wait and click
                        setTimeout(() => {
                          simulateClick(chatButton, 500);
                        }, 2000);
                      }
                    }
                  }, 10);
                }, 2000);
              }, 200);
            }, 3000);
          }, 3000);
        } else {
          agentNotification.classList.add('show');
          setTimeout(() => {
            agentNotification.classList.remove('show');
            agentHome.style.display = 'none';
            leadDetailView.classList.add('show');
          }, 3000);
        }
      }, 3000);
      
      // Final scroll to ensure dashboard is at the very bottom
      createSpeedTimeout(() => {
        const dashboardContent = document.getElementById('dashboardContent');
        if (dashboardContent) {
          const maxScroll = dashboardContent.scrollHeight - dashboardContent.clientHeight;
          let currentScroll = dashboardContent.scrollTop;
          
          // If not already at bottom, scroll to bottom
          if (currentScroll < maxScroll - 5) {
            const finalScrollInterval = setInterval(() => {
              if (isPaused) {
                clearInterval(finalScrollInterval);
                const idx = activeIntervals.indexOf(finalScrollInterval);
                if (idx > -1) activeIntervals.splice(idx, 1);
                return;
              }
              const scrollStep = 10;
              currentScroll += scrollStep;
              dashboardContent.scrollTop = currentScroll;
              
              if (currentScroll >= maxScroll) {
                clearInterval(finalScrollInterval);
                const idx = activeIntervals.indexOf(finalScrollInterval);
                if (idx > -1) activeIntervals.splice(idx, 1);
                dashboardContent.scrollTop = maxScroll; // Ensure exactly at bottom
                
                // Mark flow as completed after final scroll
                markFlowCompleted();
              }
            }, getSpeedDelay(10));
            activeIntervals.push(finalScrollInterval);
          } else {
            // Already at bottom, just ensure it's exactly at max
            dashboardContent.scrollTop = maxScroll;
            // Mark flow as completed
            markFlowCompleted();
          }
        } else {
          // If dashboardContent doesn't exist, mark as completed anyway
          markFlowCompleted();
        }
      }, 5000); // Wait a bit after details expansion
    }, 31000);
  }
  
  function addClientMessage(text, type) {
    const div = document.createElement('div');
    div.classList.add('message', type);
    
    const now = new Date();
    const timeString = now.getHours() + ':' + (now.getMinutes()<10?'0':'') + now.getMinutes();
    
    div.innerHTML = text + `<div class="meta">${timeString} ${type === 'sent' ? '‚úì‚úì' : ''}</div>`;
    clientChat.appendChild(div);
    clientChat.scrollTop = clientChat.scrollHeight;
    
    // Show typing indicator
    if (type === 'received') {
      clientTyping.style.display = 'block';
      clientStatus.innerText = 'a escrever...';
      setTimeout(() => {
        clientTyping.style.display = 'none';
        clientStatus.innerText = 'Online';
      }, 1500);
    }
  }
  
  // Agent interactions
  agentNotification.addEventListener('click', function() {
    // Show click indicator
    const rect = agentNotification.getBoundingClientRect();
    const x = rect.left + rect.width / 2;
    const y = rect.top + rect.height / 2;
    showClickAgent(x, y);
    
    setTimeout(() => {
      agentNotification.classList.remove('show');
      agentHome.style.display = 'none';
      leadDetailView.classList.add('show');
      
      // After 2 seconds, scroll to bottom and scroll conversation
      setTimeout(() => {
        // Scroll lead detail view to bottom
        const maxScroll = leadDetailView.scrollHeight - leadDetailView.clientHeight;
        let currentScroll = leadDetailView.scrollTop;
        const scrollInterval = setInterval(() => {
          const scrollStep = 8;
          currentScroll += scrollStep;
          leadDetailView.scrollTop = currentScroll;
          if (currentScroll >= maxScroll) {
            clearInterval(scrollInterval);
            leadDetailView.scrollTop = maxScroll;
            
            // Also scroll conversation full
            const conversationFull = document.getElementById('conversationFull');
            if (conversationFull && conversationFull.scrollHeight > conversationFull.clientHeight) {
              const fullMaxScroll = conversationFull.scrollHeight - conversationFull.clientHeight;
              let fullScroll = conversationFull.scrollTop;
              const fullScrollInterval = setInterval(() => {
                const scrollStep = 5;
                fullScroll += scrollStep;
                conversationFull.scrollTop = fullScroll;
                if (fullScroll >= fullMaxScroll) {
                  clearInterval(fullScrollInterval);
                  conversationFull.scrollTop = fullMaxScroll;
                  
                  // After scrolls complete, wait 2 seconds and click button
                  setTimeout(() => {
                    simulateClick(chatButton, 500);
                  }, 2000);
                }
              }, 10);
            } else {
              // If no conversation scroll needed, just wait and click
              setTimeout(() => {
                simulateClick(chatButton, 500);
              }, 2000);
            }
          }
        }, 10);
      }, 2000);
    }, 200);
  });
  
  // Dashboard button removed - notification click now handles this
  // Auto-click on notification will trigger the flow
  
  backBtnAgent.addEventListener('click', function() {
    leadDetailView.classList.remove('show');
    agentHome.style.display = 'block';
  });
  
  chatButton.addEventListener('click', function() {
    // Start agent-client conversation flow
    startAgentClientConversation();
  });
  
  // Function to start agent-client conversation
  function startAgentClientConversation() {
    // Switch highlight to client
    const clientViewSection = document.querySelector('.view-section:first-of-type');
    const agentViewSection = document.querySelector('.view-section:last-of-type');
    if (clientViewSection) {
      clientViewSection.classList.add('active');
    }
    if (agentViewSection) {
      agentViewSection.classList.remove('active');
    }
    
    // Hide client final view and show notification
    const clientFinalView = document.getElementById('clientFinalView');
    const whatsappNotificationAgent = document.getElementById('whatsappNotificationAgent');
    
    if (clientFinalView) {
      clientFinalView.style.transition = 'opacity 1s ease-out';
      clientFinalView.style.opacity = '0';
      
      setTimeout(() => {
        clientFinalView.style.display = 'none';
        
        // Show notification
        if (whatsappNotificationAgent) {
          const now = new Date();
          const timeString = now.getHours().toString().padStart(2, '0') + ':' + 
                           now.getMinutes().toString().padStart(2, '0');
          const notificationTimeAgent = document.getElementById('notificationTimeAgent');
          if (notificationTimeAgent) {
            notificationTimeAgent.textContent = timeString;
          }
          
          whatsappNotificationAgent.style.display = 'flex';
          whatsappNotificationAgent.classList.add('show');
          
          // Auto-click notification after 2 seconds
          setTimeout(() => {
            const rect = whatsappNotificationAgent.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            showClick(x, y);
            
            setTimeout(() => {
              whatsappNotificationAgent.classList.remove('show');
              whatsappNotificationAgent.style.display = 'none';
              
              // Open WhatsApp view with agent
              const whatsappViewAgent = document.getElementById('whatsappViewAgent');
              if (whatsappViewAgent) {
                whatsappViewAgent.style.display = 'block';
                whatsappViewAgent.classList.add('show');
                
                // Start conversation
                startAgentClientChat();
              }
            }, 200);
          }, 2000);
        }
      }, 1000);
    }
  }
  
  // Function to add message in agent-client chat
  function addAgentClientMessage(text, sender) {
    const agentChat = document.getElementById('agentChat');
    if (!agentChat) return;
    
    const div = document.createElement('div');
    div.classList.add('message', sender === 'joao' ? 'received' : 'sent');
    
    const now = new Date();
    const timeString = now.getHours() + ':' + (now.getMinutes()<10?'0':'') + now.getMinutes();
    
    div.innerHTML = text + `<div class="meta">${timeString} ${sender === 'pedro' ? '‚úì‚úì' : ''}</div>`;
    agentChat.appendChild(div);
    agentChat.scrollTop = agentChat.scrollHeight;
    
    // Show typing indicator for agent
    if (sender === 'joao') {
      const agentTyping = document.getElementById('agentTyping');
      if (agentTyping) {
        agentTyping.style.display = 'block';
        setTimeout(() => {
          agentTyping.style.display = 'none';
        }, 1000);
      }
    }
  }
  
  // Function to start agent-client chat
  function startAgentClientChat() {
    // Agent's first message
    setTimeout(() => {
      addAgentClientMessage("Ol√° Pedro! üëã Sou o Jo√£o Silva, consultor imobili√°rio. A minha assistente Ana falou-me sobre o seu interesse no T2 na Av. Roma e tamb√©m no T2 em Alvalade.", 'joao');
      
      // Update agent view
      updateAgentChatView("Ol√° Pedro! üëã Sou o Jo√£o Silva, consultor imobili√°rio. A minha assistente Ana falou-me sobre o seu interesse no T2 na Av. Roma e tamb√©m no T2 em Alvalade.");
    }, 1000);
    
    setTimeout(() => {
      addAgentClientMessage("Perfeito! Gostaria de agendar uma visita para ver os dois im√≥veis?", 'joao');
      updateAgentChatView("Perfeito! Gostaria de agendar uma visita para ver os dois im√≥veis?");
    }, 4000);
    
    setTimeout(() => {
      addAgentClientMessage("Sim, gostaria muito! Qual seria a melhor data?", 'pedro');
      updateAgentChatView("Sim, gostaria muito! Qual seria a melhor data?", 'pedro');
    }, 7000);
    
    setTimeout(() => {
      addAgentClientMessage("Tenho disponibilidade este s√°bado de manh√£, √†s 10h. Funciona para si?", 'joao');
      updateAgentChatView("Tenho disponibilidade este s√°bado de manh√£, √†s 10h. Funciona para si?", 'joao');
    }, 10000);
    
    setTimeout(() => {
      addAgentClientMessage("Sim, perfeito! S√°bado √†s 10h funciona muito bem.", 'pedro');
      updateAgentChatView("Sim, perfeito! S√°bado √†s 10h funciona muito bem.", 'pedro');
    }, 13000);
    
    setTimeout(() => {
      addAgentClientMessage("Excelente! ‚úÖ Fica marcado: S√°bado, 10h. Vou enviar-lhe os endere√ßos e o meu contacto. At√© s√°bado!", 'joao');
      updateAgentChatView("Excelente! ‚úÖ Fica marcado: S√°bado, 10h. Vou enviar-lhe os endere√ßos e o meu contacto. At√© s√°bado!", 'joao');
    }, 16000);
    
    setTimeout(() => {
      addAgentClientMessage("Obrigado, Jo√£o! At√© s√°bado! üëã", 'pedro');
      updateAgentChatView("Obrigado, Jo√£o! At√© s√°bado! üëã", 'pedro');
    }, 19000);
  }
  
  // Function to update agent's chat view in agent mockup
  function updateAgentChatView(message, sender = 'joao') {
    const agentChatArea = document.getElementById('conversationFull');
    if (agentChatArea) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `conversation-message message-${sender === 'joao' ? 'joao' : 'pedro'}`;
      messageDiv.innerHTML = `<strong>${sender === 'joao' ? 'Jo√£o' : 'Pedro'}:</strong> ${message}`;
      agentChatArea.appendChild(messageDiv);
      agentChatArea.scrollTop = agentChatArea.scrollHeight;
    }
  }
  
  // Restart
  // Function to mark flow as completed and change button to RESTART
  function markFlowCompleted() {
    flowCompleted = true;
    playBtn.textContent = 'üîÑ REINICIAR';
    playBtn.classList.remove('paused');
    playBtn.classList.add('restart');
  }
  
  // Simulate conversations for existing cards
  function simulateLuanaConversation() {
    const luanaPreview = document.getElementById('luanaConversationPreview');
    if (!luanaPreview) return;
    
    // Only Ana's messages (no response)
    const messages = [
      { sender: 'Ana', text: 'Ol√° Luana! üëã Sou a Ana, assistente do consultor Jo√£o Silva.' },
      { sender: 'Ana', text: 'Recebi o seu contacto pelo OLX sobre o T1 em Benfica.' },
      { sender: 'Ana', text: 'O Jo√£o est√° em visitas, mas posso ajudar com informa√ß√µes.' },
      { sender: 'Ana', text: 'Esta compra seria para habita√ß√£o pr√≥pria ou investimento?' }
    ];
    
    messages.forEach((msg, index) => {
      setTimeout(() => {
        const item = document.createElement('div');
        item.className = 'conversation-item';
        item.textContent = `${msg.sender}: ${msg.text}`;
        luanaPreview.appendChild(item);
        luanaPreview.scrollTop = luanaPreview.scrollHeight;
      }, index * 500);
    });
  }
  
  function simulateLuizConversation() {
    const luizPreview = document.getElementById('luizConversationPreview');
    if (!luizPreview) return;
    
    // Full conversation with responses
    const messages = [
      { sender: 'Ana', text: 'Ol√° Luiz! üëã Sou a Ana, assistente do consultor Jo√£o Silva.' },
      { sender: 'Ana', text: 'Recebi o seu contacto pelo Idealista sobre o T3 em Cascais.' },
      { sender: 'Luiz', text: 'Ol√°, sim, tenho interesse.' },
      { sender: 'Ana', text: 'Perfeito! Esta compra seria para habita√ß√£o pr√≥pria?' },
      { sender: 'Luiz', text: 'Sim, para mim e minha fam√≠lia.' },
      { sender: 'Ana', text: '√ìtimo! J√° tem pr√©-aprova√ß√£o banc√°ria?' },
      { sender: 'Luiz', text: 'Sim, j√° est√° aprovado.' },
      { sender: 'Ana', text: 'Excelente! Qual a sua disponibilidade para visita?' }
    ];
    
    messages.forEach((msg, index) => {
      setTimeout(() => {
        const item = document.createElement('div');
        item.className = 'conversation-item';
        item.textContent = `${msg.sender}: ${msg.text}`;
        luizPreview.appendChild(item);
        luizPreview.scrollTop = luizPreview.scrollHeight;
      }, index * 500);
    });
  }
  
  // Flow will start when user clicks PLAY button
  // startPortalFlow(); // Removed - now starts on PLAY click
  
  // Simulate conversations for existing cards
  setTimeout(() => {
    simulateLuanaConversation();
    simulateLuizConversation();
  }, 1000);
</script>

</body>
</html>

